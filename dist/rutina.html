<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GSFIT | Rutina Personalizada</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Montserrat', sans-serif; }
    .bloque::before { content: "üèãÔ∏è"; margin-right: 8px; }
  </style>
</head>
<body class="bg-white text-black dark:bg-black dark:text-white">

  <!-- Encabezado -->
  <header class="p-6 text-center border-b border-gray-300 dark:border-gray-700">
    <h1 class="text-3xl font-bold">Crea tu rutina personalizada</h1>
    <p class="text-gray-500 dark:text-gray-400 text-sm">Elige tus ejercicios y agr√∫palos por d√≠as</p>
  </header>

  <main class="max-w-3xl mx-auto p-4 space-y-6">

    <!-- Formulario de bloque -->
    <form id="formRutina" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      <!-- D√≠a de la semana -->
      <select name="dia" required class="col-span-full px-4 py-2 border rounded bg-white dark:bg-gray-900 dark:text-white">
        <option value="">Selecciona el d√≠a</option>
        <option>Lunes</option><option>Martes</option><option>Mi√©rcoles</option>
        <option>Jueves</option><option>Viernes</option><option>S√°bado</option><option>Domingo</option>
      </select>

      <!-- Ejercicio -->
      <select name="ejercicio" id="ejercicio" required class="col-span-full px-4 py-2 border rounded bg-white dark:bg-gray-900 dark:text-white"></select>

      <!-- Series, reps, carga -->
      <input type="number" name="series" placeholder="Series" required class="px-4 py-2 border rounded bg-white dark:bg-gray-900 dark:text-white" />
      <input type="number" name="reps" placeholder="Reps" required class="px-4 py-2 border rounded bg-white dark:bg-gray-900 dark:text-white" />
      <input type="number" name="carga" placeholder="Carga (kg)" class="px-4 py-2 border rounded bg-white dark:bg-gray-900 dark:text-white" />

      <!-- RPE -->
      <select name="rpe" id="rpe" class="px-4 py-2 border rounded bg-white dark:bg-gray-900 dark:text-white">
        <option value="">RPE</option>
      </select>

      <!-- Nota -->
      <input type="text" name="nota" placeholder="Nota (opcional)" class="col-span-full px-4 py-2 border rounded bg-white dark:bg-gray-900 dark:text-white" />

      <!-- Bot√≥n a√±adir -->
      <button type="submit" class="col-span-full bg-black text-white rounded py-2 hover:bg-gray-800 transition">
        A√±adir bloque
      </button>
    </form>

    <!-- Lista de bloques -->
    <section id="listaRutina" class="space-y-6 border-t pt-6"></section>

    <!-- Volumen total -->
    <div id="volumenTotal" class="text-center text-sm text-gray-600 dark:text-gray-300 mt-2">
      Volumen total: <span id="volumen">0</span> kg
    </div>

    <!-- Acciones -->
    <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
      <button onclick="exportarPDF()" class="bg-black text-white px-6 py-2 rounded hover:bg-gray-800 transition">
        Exportar PDF
      </button>
      <button onclick="limpiarRutina()" class="border border-red-500 text-red-500 px-6 py-2 rounded hover:bg-red-600 hover:text-white transition">
        Borrar todo
      </button>
    </div>

  </main>

  <!-- Librer√≠as -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- Script funcional -->
  <script>
    const ejercicios = ['Sentadilla','Press de banca','Peso muerto','Remo con barra','Dominadas','Press militar','Curl de b√≠ceps','Hip thrust'];
    let volumenTotal = 0;

    window.addEventListener('DOMContentLoaded', () => {
      const ejSelect = document.getElementById('ejercicio');
      ejercicios.forEach(ej => ejSelect.innerHTML += `<option value="${ej}">${ej}</option>`);
      for (let i = 1; i <= 10; i++) {
        document.getElementById('rpe').innerHTML += `<option value="${i}">${i}</option>`;
      }
      cargarDesdeLocalStorage();
    });

    const form = document.getElementById('formRutina');
    const lista = document.getElementById('listaRutina');
    const volumenSpan = document.getElementById('volumen');

    form.addEventListener('submit', e => {
      e.preventDefault();
      const data = new FormData(form);
      const dia = data.get('dia');
      const ejercicio = data.get('ejercicio');
      const series = +data.get('series');
      const reps = +data.get('reps');
      const carga = +data.get('carga') || 0;
      const rpe = data.get('rpe') || '-';
      const nota = data.get('nota') || '';
      const volumenBloque = series * reps * carga;
      volumenTotal += volumenBloque;
      volumenSpan.textContent = volumenTotal;

      const contenedorDia = document.getElementById('dia-' + dia) || crearSeccionDia(dia);
      const bloque = document.createElement('div');
      bloque.className = 'bloque relative border rounded-lg p-4 shadow-md bg-gray-100 dark:bg-gray-800';
      bloque.innerHTML = `
        <button class="absolute top-2 right-2 text-red-500 hover:text-red-700 text-sm" onclick="eliminarBloque(this, ${volumenBloque})">‚úñ</button>
        <p class="font-semibold">${ejercicio}</p>
        <p>${series} x ${reps} ‚Äî ${carga || '-'} kg @ RPE ${rpe}</p>
        ${nota ? `<p class="text-sm text-gray-500">${nota}</p>` : ''}
      `;

      contenedorDia.querySelector('.bloques').appendChild(bloque);
      guardarEnLocalStorage();
      form.reset();
    });

    function crearSeccionDia(dia) {
      const seccion = document.createElement('div');
      seccion.id = 'dia-' + dia;
      seccion.className = 'space-y-3';
      seccion.innerHTML = `<h2 class="text-xl font-bold mt-6">${dia}</h2><div class="bloques space-y-3"></div>`;
      lista.appendChild(seccion);
      new Sortable(seccion.querySelector('.bloques'), { animation: 150 });
      return seccion;
    }

    function eliminarBloque(btn, volumen) {
      volumenTotal -= volumen;
      volumenSpan.textContent = volumenTotal;
      btn.parentElement.remove();
      guardarEnLocalStorage();
    }

    function limpiarRutina() {
      lista.innerHTML = '';
      volumenTotal = 0;
      volumenSpan.textContent = 0;
      localStorage.removeItem('rutinaHTML');
      localStorage.removeItem('volumenTotal');
    }

    function exportarPDF() {
      const contenido = document.createElement('div');
      contenido.innerHTML = `<h1 style="font-family: Montserrat; font-size: 24px; font-weight: bold; margin-bottom: 20px;">Rutina GSFIT</h1>` +
                            lista.innerHTML +
                            `<p style="margin-top: 20px; font-weight: bold;">Volumen total: ${volumenTotal} kg</p>`;
      html2pdf().from(contenido).set({
        margin: 0.5,
        filename: 'rutina_gsfit.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      }).save();
    }

    function guardarEnLocalStorage() {
      localStorage.setItem('rutinaHTML', lista.innerHTML);
      localStorage.setItem('volumenTotal', volumenTotal);
    }

    function cargarDesdeLocalStorage() {
      if (localStorage.getItem('rutinaHTML')) {
        lista.innerHTML = localStorage.getItem('rutinaHTML');
        volumenTotal = parseInt(localStorage.getItem('volumenTotal')) || 0;
        volumenSpan.textContent = volumenTotal;
        document.querySelectorAll('.bloques').forEach(b => new Sortable(b, { animation: 150 }));
      }
    }
  </script>
</body>
</html>